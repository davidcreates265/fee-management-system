<%- include("header") -%>

</* Header Section **/>  


<div class="add-new-student-page">
  <h1 id="add-new-student-heading">Add a New Student</h1>

  <div class="add-new-student-form">
  <form action="/add-new-student" method="POST">
    <label for="year" class="form-label">Full Name:</label>
    <input type="text" class="form-control" name="name" required>
    <br>
    <label for="primaryFees" class="form-label">Age:</label>
    <input type="number" class="form-control" name="age" required>
    <br>
    <label for="secondaryFees" class="form-label">Gender:</label>
    <input type="text" class="form-control" name="gender" required>
    <br>
    <label for="level" class="form-label">Level:</label>
    <select name="level" class="form-select" required>
      <option value="">Select Level</option>
      <option value="primary">Primary School</option>
      <option value="secondary">Secondary School</option>
    </select>
    <br>
    <label for="class" class="form-label">Class:</label>
    <select name="class" class="form-select" required>
      <option value="">Select Class</option>
    </select>
    <br>
    <label for="fees" class="form-label">Fees:</label>
    <select name="fees" class="form-select" required>
      <option value="">Select Fees</option>
    </select>
    <br>
    <label for="status" class="form-label">Fees Status:</label>
    <select name="status" id="feesStatus" class="form-select" required>
      <option value="">Select Status</option>
      <option value="Not Paid">Not Paid</option>
      <option value="Paid Fully">Paid Fully</option>      
      <option value="Pending Balance">Pending Balance</option>
    </select>
    <br>
    
    <label for="paidAmount" class="form-label" style="display: none;">Paid Amount:</label>
    <input type="number" class="form-control" name="paidAmount" id="visiblePaidAmount" style="display: none;" required>
    <br>
    <br>
    
    <button class="w-100 btn btn-lg btn-primary submit-button" type="submit">Create</button>
  </form>
  </div>
</div>

<style>
  input[name="paidAmount"] {
    display: none;
  }
</style>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
  $(document).ready(function() {
    // Function to handle the visibility of the "Paid Amount" input
    function handlePaidAmountInputVisibility() {
      var status = $('#feesStatus').val();
      var paidAmountLabel = $('label[for="paidAmount"]');
      var paidAmountInput = $('input[name="paidAmount"]');
      if (status === 'Pending Balance') {
        paidAmountLabel.show();
        paidAmountInput.prop('required', true);
        paidAmountInput.show();
      } else {
        paidAmountLabel.hide();
        paidAmountInput.prop('required', false);
        paidAmountInput.hide();
      }
    }

    // When the "Level" field value changes
    $('select[name="level"]').on('change', function() {
      var level = $(this).val();
      var classSelect = $('select[name="class"]');
      var feesSelect = $('select[name="fees"]');
      
      // Clear previous options
      classSelect.empty();
      feesSelect.empty();
      
      // Populate options based on the selected level
      if (level === 'primary') {
        // Primary School options
        for (var i = 1; i <= 6; i++) {
          classSelect.append('<option value="Grade ' + i + '">Grade ' + i + '</option>');
        }
        feesSelect.append('<option value="300000">300,000</option>');
      } else if (level === 'secondary') {
        // Secondary School options
        for (var j = 1; j <= 6; j++) {
          classSelect.append('<option value="Form ' + j + '">Form ' + j + '</option>');
        }
        feesSelect.append('<option value="600000">600,000</option>');
      }

      // Call the function to handle the "Paid Amount" input visibility
      handlePaidAmountInputVisibility();
    });

    // When the "Fees Status" field value changes
    $('#feesStatus').on('change', function() {
      // Call the function to handle the "Paid Amount" input visibility
      handlePaidAmountInputVisibility();
    });

    // On form submission
    $('form').on('submit', function(event) {
      var status = $('#feesStatus').val();
      var paidAmount = parseFloat($('input[name="paidAmount"]').val()) || 0;

      var feesSelect = $('select[name="fees"]');
      var selectedFees = parseFloat(feesSelect.val()) || 0;

      if (status === 'Pending Balance') {
        // Validate the paid amount not being lower than 1 or greater than the fees
        if (paidAmount < 1 || paidAmount > selectedFees) {
          event.preventDefault();
          alert("Invalid paid amount. Please enter a valid amount.");
          return;
        }

        // Calculate the remaining balance
        var remainingBalance = selectedFees - paidAmount;

        // Update the feesSelect element with the new remaining balance
        feesSelect.empty();
        feesSelect.append('<option value="' + remainingBalance + '">' + remainingBalance + '</option>');
      }
    });
  });


  const visibleInput = document.getElementById("visiblePaidAmount");
  const invisibleInput = document.getElementById("invisiblePaidAmount");

  // Function to synchronize the values
  function syncInputs() {
    invisibleInput.value = visibleInput.value;
  }

  // Add event listener to visible input for real-time synchronization
  visibleInput.addEventListener("input", syncInputs);
</script>

<%- include("footer") -%>
